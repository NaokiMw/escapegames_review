<h3>レビュー一覧</h3>

<table>
  <thead>
    <tr>
      <th>ユーザー名</th>
      <th>タイトル</th>
      <th>総合評価</th>
      <th>タイプ</th>
      <th>ストーリー</th>
      <th>満足度</th>
      <th>むずかしさ</th>
      <th>場所</th>
      <th>遊んだ日</th>
      <th>開始時間</th>
      <th>結果</th>
      <th>記念写真</th>
      <th>登録日</th>
    </tr>
  </thead>

  <tbody>
    <% @reviews.each do |review| %>
      <tr>
        <td><%= review.user.username %></td>
        <td><%= review.title %></td>
        <td>
          <div id="star-rate<%= review.id%>"></div>    
            <script>
            $('#star-rate<%= review.id%>').raty({
              size      : 36,
              starOff   : '<%= asset_path('star-off.png') %>',
              starOn    : '<%= asset_path('star-on.png') %>',
              starHalf  : '<%= asset_path('star-half.png') %>',
              half      : true,
              readOnly: true,
              score: 'review[review_1]',
              });
            </script>
        </td>
        <td><%= review.review_2 %></td>
        <td><%= review.review_3 %></td>
        <td><%= review.review_4 %></td>
        <td><%= review.review_5 %></td>
        <td><%= review.place %></td>
        <td><%= l review.play_day, format: :short %></td>
        <td><%= l review.start_time, format: :short %></td>
        <td>
          <%= review.result ? '成功' : '失敗' %>
        </td>
        <td>
          <%= image_tag review.image.variant(resize_to_fill: [150, 150]).processed, class: 'review-image' %>    
        </td>
        <td><%= l review.created_at, format: :default %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<% @reviews.each do |review| %>
  <% if user_signed_in? %>
    <% if review.favorited_by?(current_user) %> <!-- ログインしているユーザーがファボしたかどうかで分岐 -->
      <p><i class="fa fa-heart unlike-btn"></i><%=link_to review.favorites.count, review_favorites_path(review.id), method: :delete %></p>
    <% else %>
      <p><i class="fa fa-heart like-btn"></i><%=link_to review.favorites.count, review_favorites_path(review.id), method: :post %></p>
    <% end %>
  <% else %>
    <p><i class="fa fa-heart like-btn"><%= review.favorites.count %></p>
  <% end %>

  <% if current_user != review.user %>
    <% if review.user.followed_by?(current_user) %>
      <p><%=link_to "フォロー済み", user_relationships_path(review.user.id), method: :delete %></p>
    <% else %>
      <p><%=link_to "フォローする", user_relationships_path(review.user.id), method: :post %></p>
    <% end %>
  <% end %>
<% end %>
<p><%= link_to "イベント新規登録", new_review_path %></p>
